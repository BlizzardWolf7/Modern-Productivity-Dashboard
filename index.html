<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Productivity Dashboard</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="A beautiful, modern productivity dashboard with tasks, notes, weather, and more">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Dashboard">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/ios/180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/ios/32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/ios/16.png">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BlizzardWolf7/Toast-Notification-Library@main/toast.css">
  <style>
    :root {
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
      --text: #2d3748;
      --accent: #667eea;
      --accent-hover: #5a67d8;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    body.dark {
      --bg: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
      --card-bg: rgba(45, 55, 72, 0.95);
      --text: #f7fafc;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      z-index: -1;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      opacity: 0;
      animation: fadeIn 0.6s ease-out forwards;
      animation-delay: 0.1s;
    }

    #greeting {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 2rem;
      font-weight: 500;
      opacity: 0;
      animation: fadeIn 0.6s ease-out forwards;
      animation-delay: 0.2s;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      width: 100%;
      max-width: 1000px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 2rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .card:nth-child(1) {
      animation-delay: 0.3s;
    }

    .card:nth-child(2) {
      animation-delay: 0.4s;
    }

    .card:nth-child(3) {
      animation-delay: 0.5s;
    }

    .card:nth-child(4) {
      animation-delay: 0.6s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Clock */
    .clock {
      font-size: 2.8rem;
      text-align: center;
      letter-spacing: 3px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    body.dark .clock {
      background: linear-gradient(135deg, #667eea, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Weather */
    .weather {
      text-align: center;
    }

    .weather h2 {
      margin-bottom: 1rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .weather p {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .weather small {
      color: #4a5568;
      font-size: 0.95rem;
      font-weight: 500;
      display: inline-block;
      padding: 0.4rem 0.8rem;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 20px;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }

    body.dark .weather small {
      color: #cbd5e0;
      background: rgba(102, 126, 234, 0.15);
    }

    /* To-Do Widget */
    .todo-widget {
      text-align: center;
    }

    .todo-widget h2 {
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .todo-count {
      font-size: 0.95rem;
      color: var(--text);
      opacity: 0.7;
      margin-bottom: 0.25rem;
    }

    .tasks-overdue {
      font-size: 0.9rem;
      color: #ef4444;
      font-weight: 600;
      margin-bottom: 0.35rem;
      padding: 0.4rem 0.6rem;
      background: rgba(239, 68, 68, 0.15);
      border-radius: 8px;
      display: inline-block;
    }

    .tasks-overdue.has-tasks {
      animation: pulse 2s ease-in-out infinite;
    }

    body.dark .tasks-overdue {
      background: rgba(239, 68, 68, 0.2);
    }

    .tasks-due-today {
      font-size: 0.9rem;
      color: #f59e0b;
      font-weight: 600;
      margin-bottom: 1rem;
      padding: 0.4rem 0.6rem;
      background: rgba(251, 191, 36, 0.15);
      border-radius: 8px;
      display: inline-block;
    }

    .tasks-due-today.has-tasks {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }

    body.dark .tasks-due-today {
      background: rgba(251, 191, 36, 0.2);
    }

    .todo-btn {
      width: 100%;
      padding: 0.75rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .todo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    /* To-Do Lists Modal */
    #todoModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1001;
    }

    #todoModal.active {
      display: flex;
    }

    .todo-modal {
      max-width: 900px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .create-list-btn {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1.5rem;
      border: 2px dashed rgba(102, 126, 234, 0.4);
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .create-list-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: var(--accent);
    }

    #todoListsContainer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .todo-list-card {
      position: relative;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1.5rem;
      border-left: 4px solid;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .todo-list-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }

    .todo-list-card.has-overdue {
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.25);
    }

    .todo-list-card.has-overdue:hover {
      box-shadow: 0 6px 25px rgba(239, 68, 68, 0.35);
    }

    body.dark .todo-list-card.has-overdue {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, var(--card-bg) 50%);
    }

    .todo-list-card.has-due-today {
      box-shadow: 0 4px 20px rgba(251, 191, 36, 0.2);
    }

    .todo-list-card.has-due-today:hover {
      box-shadow: 0 6px 25px rgba(251, 191, 36, 0.3);
    }

    body.dark .todo-list-card.has-due-today {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, var(--card-bg) 50%);
    }

    .todo-list-card.blue { border-left-color: #3b82f6; }
    .todo-list-card.green { border-left-color: #10b981; }
    .todo-list-card.purple { border-left-color: #8b5cf6; }
    .todo-list-card.orange { border-left-color: #f97316; }
    .todo-list-card.pink { border-left-color: #ec4899; }
    .todo-list-card.red { border-left-color: #ef4444; }

    .overdue-badge {
      background: linear-gradient(135deg, #fca5a5, #f87171);
      color: #7f1d1d;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.4rem 0.7rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
      margin-top: 1rem;
      width: 100%;
    }

    body.dark .overdue-badge {
      color: #fff;
    }

    .due-today-badge {
      background: linear-gradient(135deg, #fcd34d, #fbbf24);
      color: #78350f;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.4rem 0.7rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);
      margin-top: 1rem;
      width: 100%;
    }

    body.dark .due-today-badge {
      color: #78350f;
    }

    .todo-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .todo-list-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text);
    }

    .todo-list-count {
      font-size: 0.85rem;
      opacity: 0.7;
      color: var(--text);
    }

    .todo-list-tasks {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .todo-list-task {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0;
      font-size: 0.9rem;
      color: var(--text);
    }

    .todo-list-task.done {
      text-decoration: line-through;
      opacity: 0.5;
    }

    .todo-list-task::before {
      content: '○';
      font-size: 0.8rem;
      opacity: 0.5;
    }

    .todo-list-task.done::before {
      content: '●';
    }

    .empty-todo {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text);
      opacity: 0.6;
    }

    /* Create List Modal */
    #createListModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1002;
    }

    #createListModal.active {
      display: flex;
    }

    .create-list-modal {
      max-width: 500px;
      width: 90%;
    }

    .create-list-modal input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1.5rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .create-list-modal input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(102, 126, 234, 0.1);
    }

    /* View List Modal */
    #viewListModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1002;
    }

    #viewListModal.active {
      display: flex;
    }

    .view-list-modal {
      max-width: 600px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .list-header-with-settings {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .list-header-with-settings h3 {
      margin: 0;
    }

    .list-settings-btn {
      background: rgba(102, 126, 234, 0.1);
      border: none;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.2s ease;
      color: var(--text);
    }

    .list-settings-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: rotate(90deg);
    }

    .task-stats {
      text-align: center;
      margin-bottom: 1.25rem;
      padding: 0.5rem;
      background: rgba(102, 126, 234, 0.08);
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }

    .add-task-section {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding: 1.25rem;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border: 2px dashed rgba(102, 126, 234, 0.2);
    }

    .add-task-section input {
      width: 100%;
      padding: 0.85rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .add-task-section input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--card-bg);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .add-task-section .task-note-input {
      font-size: 0.85rem;
      opacity: 0.9;
      font-style: italic;
    }

    body.dark .add-task-section input {
      background: rgba(45, 55, 72, 0.8);
    }

    body.dark .add-task-section input:focus {
      background: rgba(45, 55, 72, 0.9);
    }

    .add-task-section button {
      width: 100%;
      padding: 0.85rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .add-task-section button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .add-task-section button:active {
      transform: translateY(0);
    }

    .task-options {
      display: flex;
      gap: 0.75rem;
    }

    .task-option {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .task-option label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.7;
      margin: 0;
    }

    .task-select,
    .task-date {
      padding: 0.65rem;
      border-radius: 8px;
      border: 2px solid transparent;
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .task-select:focus,
    .task-date:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    body.dark .task-select,
    body.dark .task-date {
      background: rgba(45, 55, 72, 0.8);
    }

    .view-list-tasks {
      list-style: none;
      padding: 0;
      margin: 0 0 1.5rem 0;
      max-height: 400px;
      overflow-y: auto;
    }

    .view-list-tasks li {
      position: relative;
      background: rgba(102, 126, 234, 0.08);
      color: var(--text);
      padding: 1rem 1.25rem;
      padding-right: 3rem;
      border-radius: 12px;
      margin-bottom: 0.75rem;
      border-left: 4px solid var(--accent);
      transition: all 0.2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .view-list-tasks li:hover {
      background: rgba(102, 126, 234, 0.12);
      transform: translateX(3px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    body.dark .view-list-tasks li {
      background: rgba(102, 126, 234, 0.15);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    body.dark .view-list-tasks li:hover {
      background: rgba(102, 126, 234, 0.2);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .view-list-tasks li span {
      cursor: pointer;
      font-size: 0.95rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      width: 100%;
    }

    .view-list-tasks li span.done .task-text {
      text-decoration: line-through;
      opacity: 0.5;
    }

    .task-text {
      font-weight: 600;
      font-size: 1rem;
      line-height: 1.4;
    }

    .task-note {
      font-size: 0.85rem;
      opacity: 0.65;
      font-style: italic;
      line-height: 1.3;
      padding-left: 0.5rem;
      border-left: 2px solid rgba(102, 126, 234, 0.3);
    }

    .view-list-tasks li span.done .task-note {
      opacity: 0.35;
      text-decoration: line-through;
    }

    .task-metadata {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 0.4rem;
    }

    .priority-badge,
    .due-date-badge {
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .priority-badge.high {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: #fff;
    }

    .priority-badge.medium {
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: #fff;
    }

    .priority-badge.low {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: #fff;
    }

    .due-date-badge {
      background: rgba(102, 126, 234, 0.15);
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .due-date-badge.overdue {
      background: linear-gradient(135deg, #fca5a5, #f87171);
      color: #7f1d1d;
      font-weight: 700;
    }

    body.dark .due-date-badge.overdue {
      color: #fff;
    }

    .due-date-badge.today {
      background: linear-gradient(135deg, #fde68a, #fcd34d);
      color: #78350f;
      font-weight: 700;
    }

    body.dark .due-date-badge.today {
      color: #78350f;
    }

    .view-list-tasks li span.done .task-metadata {
      opacity: 0.4;
    }

    .view-list-tasks li button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      border: none;
      background: rgba(245, 101, 101, 0.1);
      color: #f56565;
      cursor: pointer;
      font-size: 1rem;
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: 6px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
    }

    .view-list-tasks li:hover button {
      opacity: 1;
    }

    .view-list-tasks li button:hover {
      background: rgba(245, 101, 101, 0.2);
      transform: scale(1.15);
      box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
    }

    .view-list-tasks li button:active {
      transform: scale(1);
    }

    .empty-tasks {
      text-align: center;
      padding: 2rem;
      color: var(--text);
      opacity: 0.5;
      font-size: 0.95rem;
    }

    /* List Settings Modal */
    #listSettingsModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1003;
    }

    #listSettingsModal.active {
      display: flex;
    }

    .list-settings-modal {
      max-width: 450px;
      width: 90%;
    }

    .list-settings-modal label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .list-settings-modal input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1.5rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .list-settings-modal input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(102, 126, 234, 0.1);
    }

    .list-colors {
      margin-bottom: 1.5rem;
    }

    .list-colors label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .list-color-options {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .list-color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s ease;
      position: relative;
    }

    .list-color-option:hover {
      transform: scale(1.1);
    }

    .list-color-option.active {
      border-color: var(--text);
      box-shadow: 0 0 0 2px var(--card-bg);
    }

    .list-color-option.active::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
      font-size: 1.2rem;
      color: #fff;
    }

    .list-color-option.blue { background: #3b82f6; }
    .list-color-option.green { background: #10b981; }
    .list-color-option.purple { background: #8b5cf6; }
    .list-color-option.orange { background: #f97316; }
    .list-color-option.pink { background: #ec4899; }
    .list-color-option.red { background: #ef4444; }

    .list-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .save-list-btn,
    .delete-list-btn,
    .cancel-list-btn {
      flex: 1;
      min-width: 120px;
      padding: 0.75rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .save-list-btn {
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
    }

    .save-list-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .delete-list-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: #fff;
    }

    .delete-list-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
    }

    .cancel-list-btn {
      background: rgba(102, 126, 234, 0.1);
      color: var(--text);
      border: 2px solid rgba(102, 126, 234, 0.3);
    }

    .cancel-list-btn:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    /* Global Search Modal */
    #searchModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1004;
    }

    #searchModal.active {
      display: flex;
    }

    .search-modal {
      max-width: 700px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .search-modal input[type="text"] {
      width: 100%;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 12px;
      border: 2px solid var(--accent);
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .search-modal input[type="text"]:focus {
      outline: none;
      background: rgba(102, 126, 234, 0.1);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
    }

    body.dark .search-modal input[type="text"] {
      background: rgba(102, 126, 234, 0.1);
    }

    .search-results {
      margin-bottom: 1.5rem;
      min-height: 200px;
      max-height: 450px;
      overflow-y: auto;
    }

    .search-empty {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text);
      opacity: 0.6;
    }

    .search-no-results {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--text);
      opacity: 0.6;
    }

    .search-section {
      margin-bottom: 1.5rem;
    }

    .search-section-title {
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text);
      opacity: 0.6;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid rgba(102, 126, 234, 0.2);
    }

    .search-result-item {
      padding: 1rem;
      margin-bottom: 0.75rem;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 4px solid;
    }

    .search-result-item:hover {
      background: rgba(102, 126, 234, 0.12);
      transform: translateX(3px);
    }

    body.dark .search-result-item {
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .search-result-item:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    .search-result-item.task {
      border-left-color: var(--accent);
    }

    .search-result-item.note {
      border-left-color: #f59e0b;
    }

    .search-result-type {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      opacity: 0.6;
      margin-bottom: 0.25rem;
    }

    .search-result-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
      color: var(--text);
    }

    .search-result-content {
      font-size: 0.85rem;
      opacity: 0.75;
      color: var(--text);
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .search-result-meta {
      font-size: 0.75rem;
      opacity: 0.5;
      margin-top: 0.5rem;
      font-style: italic;
    }

    .search-highlight {
      background: rgba(255, 235, 59, 0.4);
      font-weight: 600;
      padding: 0 0.2rem;
      border-radius: 3px;
    }

    body.dark .search-highlight {
      background: rgba(255, 235, 59, 0.3);
    }

    /* Top Action Buttons */
    .top-actions {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      display: flex;
      gap: 0.75rem;
      z-index: 100;
    }

    #searchBtn,
    #settingsBtn {
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.4rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    #searchBtn:hover,
    #settingsBtn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    #settingsBtn:hover {
      transform: rotate(90deg) scale(1.1);
    }

    #settingsModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1000;
    }

    #settingsModal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      color: var(--text);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow);
      min-width: 350px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideIn 0.4s ease-out;
    }

    .modal-content h3 {
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-content label {
      display: block;
      margin-top: 1rem;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }

    .modal-content input[type="text"],
    .modal-content input[type="color"] {
      width: 100%;
      padding: 0.75rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .modal-content input[type="text"]:focus,
    .modal-content input[type="color"]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .modal-content input[type="text"],
    body.dark .modal-content input[type="color"] {
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .modal-content input[type="text"]:focus,
    body.dark .modal-content input[type="color"]:focus {
      background: rgba(102, 126, 234, 0.15);
    }

    .modal-content input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 0.5rem;
      cursor: pointer;
      accent-color: var(--accent);
    }

    .connection-status {
      margin-top: 1.5rem;
      padding: 0.75rem;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 10px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    body.dark .connection-status {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .status-label {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.4rem 0.75rem;
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .status-indicator.online {
      background: rgba(16, 185, 129, 0.15);
      color: #059669;
    }

    body.dark .status-indicator.online {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .status-indicator.offline {
      background: rgba(239, 68, 68, 0.15);
      color: #dc2626;
    }

    body.dark .status-indicator.offline {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse-dot 2s ease-in-out infinite;
    }

    .status-indicator.offline .status-dot {
      animation: none;
    }

    @keyframes pulse-dot {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* Settings Sections */
    .settings-section {
      margin-bottom: 1rem;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid rgba(102, 126, 234, 0.2);
      background: rgba(102, 126, 234, 0.03);
    }

    body.dark .settings-section {
      background: rgba(102, 126, 234, 0.05);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .section-header {
      padding: 0.9rem 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(102, 126, 234, 0.08);
      transition: all 0.2s ease;
      user-select: none;
    }

    .section-header:hover {
      background: rgba(102, 126, 234, 0.12);
    }

    body.dark .section-header {
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .section-header:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    .section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-icon {
      font-size: 1.2rem;
    }

    .section-toggle {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
      color: var(--text);
      opacity: 0.6;
    }

    .settings-section.open .section-toggle {
      transform: rotate(180deg);
    }

    .section-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      padding: 0 1rem;
    }

    .settings-section.open .section-content {
      max-height: 800px;
      padding: 1rem;
    }

    .section-content label {
      margin-top: 0.75rem;
    }

    .section-content label:first-child {
      margin-top: 0;
    }

    .cache-reset-btn {
      background: linear-gradient(135deg, #f59e0b, #d97706) !important;
      margin-top: 0.75rem !important;
      display: flex !important;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .cache-reset-btn:hover {
      box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4) !important;
    }

    .app-info {
      background: rgba(102, 126, 234, 0.05);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 2px solid rgba(102, 126, 234, 0.2);
    }

    body.dark .app-info {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    body.dark .info-row {
      border-bottom-color: rgba(102, 126, 234, 0.15);
    }

    .info-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      opacity: 0.7;
    }

    .info-value {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent);
      font-family: 'Courier New', monospace;
    }

    .modal-content button {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.75rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .modal-content button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .modal-content button:active {
      transform: translateY(0);
    }

    .github-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      padding: 0.75rem;
      border: 2px solid rgba(102, 126, 234, 0.3);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .github-link:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .github-link svg {
      transition: transform 0.3s ease;
    }

    .github-link:hover svg {
      transform: rotate(360deg);
    }

    body.dark .github-link {
      border-color: rgba(102, 126, 234, 0.4);
    }

    body.dark .github-link:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    /* Keyboard Shortcuts Button */
    .shortcuts-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      padding: 0.75rem;
      border: 2px solid rgba(102, 126, 234, 0.3);
      background: transparent;
      color: var(--text);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .shortcuts-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    body.dark .shortcuts-btn {
      border-color: rgba(102, 126, 234, 0.4);
    }

    body.dark .shortcuts-btn:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    /* Keyboard Shortcuts Modal */
    #shortcutsModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1001;
    }

    #shortcutsModal.active {
      display: flex;
    }

    .shortcuts-modal {
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .shortcuts-modal h3 {
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 8px;
      transition: background 0.2s ease;
    }

    .shortcut-item:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .shortcut-item {
      background: rgba(102, 126, 234, 0.1);
    }

    body.dark .shortcut-item:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    .shortcut-description {
      font-size: 0.9rem;
      color: var(--text);
      opacity: 0.9;
    }

    .shortcut-keys {
      display: flex;
      gap: 0.4rem;
      align-items: center;
    }

    .key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
      padding: 0 0.5rem;
      background: linear-gradient(180deg, #fff 0%, #f0f0f0 100%);
      border: 1px solid #d0d0d0;
      border-bottom: 3px solid #b0b0b0;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      color: #333;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      text-transform: uppercase;
      transition: all 0.15s ease;
    }

    body.dark .key {
      background: linear-gradient(180deg, #4a5568 0%, #2d3748 100%);
      border: 1px solid #1a202c;
      border-bottom: 3px solid #1a202c;
      color: #f7fafc;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .key:active {
      transform: translateY(1px);
      border-bottom-width: 2px;
    }

    .key svg {
      width: 16px;
      height: 16px;
    }

    .key-plus {
      font-size: 0.9rem;
      color: var(--text);
      opacity: 0.6;
      font-weight: 500;
    }

    .modal-close-btn {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.75rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .modal-close-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .modal-close-btn:active {
      transform: translateY(0);
    }

    /* Notes Widget */
    .notes-widget {
      text-align: center;
    }

    .notes-widget h2 {
      margin-bottom: 0.5rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .notes-count {
      font-size: 0.95rem;
      color: var(--text);
      opacity: 0.7;
      margin-bottom: 1rem;
    }

    .notes-btn {
      width: 100%;
      padding: 0.75rem;
      border: none;
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .notes-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    /* Notes Modal */
    #notesModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1001;
    }

    #notesModal.active {
      display: flex;
    }

    .notes-modal {
      max-width: 900px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .create-note-btn {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1.5rem;
      border: 2px dashed rgba(102, 126, 234, 0.4);
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .create-note-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: var(--accent);
    }

    .notes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .sticky-note {
      position: relative;
      padding: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-height: 150px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .sticky-note:hover {
      transform: translateY(-5px) rotate(1deg);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .sticky-note.yellow {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      color: #78350f;
    }

    .sticky-note.pink {
      background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
      color: #831843;
    }

    .sticky-note.blue {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      color: #1e3a8a;
    }

    .sticky-note.green {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      color: #064e3b;
    }

    .sticky-note.purple {
      background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%);
      color: #581c87;
    }

    .sticky-note.orange {
      background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
      color: #7c2d12;
    }

    .sticky-note-title {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .sticky-note-preview {
      font-size: 0.85rem;
      opacity: 0.8;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4;
      line-clamp: 4;
      -webkit-box-orient: vertical;
      flex-grow: 1;
    }

    .sticky-note-date {
      font-size: 0.75rem;
      opacity: 0.6;
      margin-top: 0.5rem;
    }

    .empty-notes {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text);
      opacity: 0.6;
    }

    .empty-notes svg {
      width: 80px;
      height: 80px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Note Edit Modal */
    #noteEditModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1002;
    }

    #noteEditModal.active {
      display: flex;
    }

    .note-edit-modal {
      max-width: 600px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
    }

    .note-edit-modal input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .note-edit-modal input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(102, 126, 234, 0.1);
    }

    .note-edit-modal textarea {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      border: 2px solid transparent;
      background: rgba(102, 126, 234, 0.05);
      color: var(--text);
      font-size: 0.95rem;
      font-family: inherit;
      resize: vertical;
      transition: all 0.3s ease;
    }

    .note-edit-modal textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(102, 126, 234, 0.1);
    }

    .note-colors {
      margin-bottom: 1.5rem;
    }

    .note-colors label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .color-options {
      display: flex;
      gap: 0.75rem;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s ease;
      position: relative;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.active {
      border-color: var(--text);
      box-shadow: 0 0 0 2px var(--card-bg);
    }

    .color-option.active::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
      font-size: 1.2rem;
    }

    .color-option.yellow {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
    }

    .color-option.pink {
      background: linear-gradient(135deg, #fce7f3, #fbcfe8);
    }

    .color-option.blue {
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    }

    .color-option.green {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    }

    .color-option.purple {
      background: linear-gradient(135deg, #e9d5ff, #d8b4fe);
    }

    .color-option.orange {
      background: linear-gradient(135deg, #fed7aa, #fdba74);
    }

    .note-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .save-note-btn,
    .delete-note-btn,
    .cancel-note-btn {
      flex: 1;
      min-width: 120px;
      padding: 0.75rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .save-note-btn {
      background: linear-gradient(135deg, var(--accent), #764ba2);
      color: #fff;
    }

    .save-note-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .delete-note-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: #fff;
    }

    .delete-note-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
    }

    .cancel-note-btn {
      background: rgba(102, 126, 234, 0.1);
      color: var(--text);
      border: 2px solid rgba(102, 126, 234, 0.3);
    }

    .cancel-note-btn:hover {
      background: rgba(102, 126, 234, 0.15);
    }

    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      opacity: 0;
      animation: fadeIn 0.6s ease-out forwards;
      animation-delay: 0.6s;
    }

    body.dark footer {
      color: rgba(255, 255, 255, 0.5);
    }

    footer a {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      font-weight: 600;
      position: relative;
      transition: color 0.3s ease;
    }

    footer a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.6));
      transition: width 0.3s ease;
    }

    footer a:hover {
      color: #fff;
    }

    footer a:hover::after {
      width: 100%;
    }

    body.dark footer a {
      color: rgba(255, 255, 255, 0.8);
    }

    body.dark footer a:hover {
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="top-actions">
    <button id="searchBtn" title="Search">🔍</button>
    <button id="settingsBtn" title="Settings">⚙️</button>
  </div>
  <h1>My Productivity Dashboard</h1>
  <div id="greeting"></div>

  <div class="dashboard">
    <div class="card">
      <h2>Current Time</h2>
      <div class="clock" id="clock">--:--:--</div>
    </div>

    <div class="card">
      <div class="weather">
        <h2>Weather</h2>
        <p id="weather">Loading...</p>
        <small id="location"></small>
      </div>
    </div>

    <div class="card">
      <div class="todo-widget">
        <h2>To-Do Lists</h2>
        <p class="todo-count" id="todoCount">0 tasks</p>
        <p class="tasks-overdue" id="tasksOverdue">0 tasks overdue</p>
        <p class="tasks-due-today" id="tasksDueToday">0 tasks due today</p>
        <button id="openTodoBtn" class="todo-btn">✓ View Tasks</button>
      </div>
    </div>

    <div class="card">
      <div class="notes-widget">
        <h2>Notes</h2>
        <p class="notes-count" id="notesCount">0 notes</p>
        <button id="openNotesBtn" class="notes-btn">📝 View Notes</button>
      </div>
    </div>
  </div>

  <footer>Built by <a href="https://simonringwelski.dk/" target="_blank" rel="noopener noreferrer">SimonRingwelski</a> • HTML + CSS + JS</footer>

  <!-- Settings Modal -->
  <div id="settingsModal">
    <div class="modal-content">
      <h3>Settings</h3>
      
      <!-- Styling Section -->
      <div class="settings-section open" id="stylingSection">
        <div class="section-header">
          <div class="section-title">
            <span class="section-icon">🎨</span>
            <span>Styling</span>
          </div>
          <span class="section-toggle">▼</span>
        </div>
        <div class="section-content">
          <label>Dashboard Title:</label>
          <input type="text" id="dashboardTitle" placeholder="Enter dashboard title" />
          
          <label>Your Name:</label>
          <input type="text" id="userName" placeholder="Enter your name" />
          
          <label>Accent Color:</label>
          <input type="color" id="accentColor" />
          
          <label>
            <input type="checkbox" id="darkModeToggle" /> Dark Mode
          </label>

          <label>
            <input type="checkbox" id="showGreetingToggle" /> Show Greeting
          </label>
        </div>
      </div>

      <!-- Connection Section -->
      <div class="settings-section" id="connectionSection">
        <div class="section-header">
          <div class="section-title">
            <span class="section-icon">🌐</span>
            <span>Connection</span>
          </div>
          <span class="section-toggle">▼</span>
        </div>
        <div class="section-content">
          <div id="connectionStatus" class="connection-status">
            <span class="status-label">Status:</span>
            <span id="statusIndicator" class="status-indicator online">
              <span class="status-dot"></span>
              <span class="status-text">Online</span>
            </span>
          </div>
          
          <button id="clearCacheBtn" class="cache-reset-btn">
            🗑️ Clear App Cache
          </button>
        </div>
      </div>

      <!-- Guide/About Section -->
      <div class="settings-section" id="guideSection">
        <div class="section-header">
          <div class="section-title">
            <span class="section-icon">📖</span>
            <span>Guide & About</span>
          </div>
          <span class="section-toggle">▼</span>
        </div>
        <div class="section-content">
          <div class="app-info">
            <div class="info-row">
              <span class="info-label">App Version:</span>
              <span class="info-value">v1.0.7</span>
            </div>
            <div class="info-row">
              <span class="info-label">Last Updated:</span>
              <span class="info-value">October 14, 2025</span>
            </div>
            <div class="info-row">
              <span class="info-label">Last Checked:</span>
              <span class="info-value" id="lastChecked">Just now</span>
            </div>
          </div>

          <a href="https://github.com/BlizzardWolf7" target="_blank" rel="noopener noreferrer" class="github-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            View GitHub Profile
          </a>

          <button id="shortcutsBtn" class="shortcuts-btn">
            ⌨️ Keyboard Shortcuts
          </button>
        </div>
      </div>
      
      <button id="saveSettings">Save Settings</button>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div id="shortcutsModal">
    <div class="modal-content shortcuts-modal">
      <h3>⌨️ Keyboard Shortcuts</h3>
      
      <div class="shortcut-item">
        <span class="shortcut-description">Add task</span>
        <div class="shortcut-keys">
          <span class="key">Enter</span>
        </div>
      </div>

      <div class="shortcut-item">
        <span class="shortcut-description">Close modal</span>
        <div class="shortcut-keys">
          <span class="key">Esc</span>
        </div>
      </div>

      <div class="shortcut-item">
        <span class="shortcut-description">Search tasks & notes</span>
        <div class="shortcut-keys">
          <span class="key">Ctrl</span>
          <span class="key-plus">+</span>
          <span class="key">F</span>
        </div>
      </div>

      <div class="shortcut-item">
        <span class="shortcut-description">Open settings</span>
        <div class="shortcut-keys">
          <span class="key">Ctrl</span>
          <span class="key-plus">+</span>
          <span class="key">S</span>
        </div>
      </div>

      <div class="shortcut-item">
        <span class="shortcut-description">Toggle dark mode</span>
        <div class="shortcut-keys">
          <span class="key">Ctrl</span>
          <span class="key-plus">+</span>
          <span class="key">D</span>
        </div>
      </div>

      <div class="shortcut-item">
        <span class="shortcut-description">View shortcuts</span>
        <div class="shortcut-keys">
          <span class="key">Ctrl</span>
          <span class="key-plus">+</span>
          <span class="key">K</span>
        </div>
      </div>

      <button id="closeShortcutsBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <!-- To-Do Lists Modal -->
  <div id="todoModal">
    <div class="modal-content todo-modal">
      <h3>✓ My To-Do Lists</h3>
      <button id="createListBtn" class="create-list-btn">+ New List</button>
      <div id="todoListsContainer">
        <!-- To-do lists will be dynamically added here -->
      </div>
      <button id="closeTodoBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <!-- Create List Modal -->
  <div id="createListModal">
    <div class="modal-content create-list-modal">
      <h3>Create New List</h3>
      <input type="text" id="newListNameInput" placeholder="List name (e.g., Work, Shopping)..." maxlength="30" />
      
      <div class="list-colors">
        <label>Color:</label>
        <div class="list-color-options" id="createListColors">
          <div class="list-color-option blue active" data-color="blue"></div>
          <div class="list-color-option green" data-color="green"></div>
          <div class="list-color-option purple" data-color="purple"></div>
          <div class="list-color-option orange" data-color="orange"></div>
          <div class="list-color-option pink" data-color="pink"></div>
          <div class="list-color-option red" data-color="red"></div>
        </div>
      </div>
      
      <div class="list-actions">
        <button id="createListSaveBtn" class="save-list-btn">Create List</button>
        <button id="createListCancelBtn" class="cancel-list-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- View/Edit Tasks Modal -->
  <div id="viewListModal">
    <div class="modal-content view-list-modal">
      <div class="list-header-with-settings">
        <h3 id="viewListName">List Name</h3>
        <button id="listSettingsBtn" class="list-settings-btn" title="List Settings">⚙️</button>
      </div>
      
      <div class="task-stats">
        <span id="taskProgress">0/0 completed</span>
      </div>

      <div class="add-task-section">
        <input type="text" id="viewListTaskInput" placeholder="Task title..." />
        <input type="text" id="viewListTaskNote" placeholder="Optional note..." class="task-note-input" />
        
        <div class="task-options">
          <div class="task-option">
            <label>Priority:</label>
            <select id="taskPriority" class="task-select">
              <option value="none">None</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="task-option">
            <label>Due Date:</label>
            <input type="date" id="taskDueDate" class="task-date" />
          </div>
        </div>
        
        <button id="viewListAddTaskBtn">+ Add Task</button>
      </div>

      <ul id="viewListTasks" class="view-list-tasks">
        <!-- Tasks will be added here -->
      </ul>
      
      <button id="closeViewListBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <!-- List Settings Modal -->
  <div id="listSettingsModal">
    <div class="modal-content list-settings-modal">
      <h3>List Settings</h3>
      
      <label>List Name:</label>
      <input type="text" id="settingsListNameInput" placeholder="List name..." maxlength="30" />
      
      <div class="list-colors">
        <label>Color:</label>
        <div class="list-color-options" id="settingsListColors">
          <div class="list-color-option blue" data-color="blue"></div>
          <div class="list-color-option green" data-color="green"></div>
          <div class="list-color-option purple" data-color="purple"></div>
          <div class="list-color-option orange" data-color="orange"></div>
          <div class="list-color-option pink" data-color="pink"></div>
          <div class="list-color-option red" data-color="red"></div>
        </div>
      </div>
      
      <div class="list-actions">
        <button id="saveListSettingsBtn" class="save-list-btn">Save Changes</button>
        <button id="deleteListFromSettingsBtn" class="delete-list-btn">Delete List</button>
        <button id="cancelListSettingsBtn" class="cancel-list-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Global Search Modal -->
  <div id="searchModal">
    <div class="modal-content search-modal">
      <h3>🔍 Search</h3>
      <input type="text" id="searchInput" placeholder="Search tasks and notes..." autofocus />
      
      <div id="searchResults" class="search-results">
        <div class="search-empty">
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">🔍</div>
          <p>Type to search across all tasks and notes</p>
        </div>
      </div>
      
      <button id="closeSearchBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <!-- Notes List Modal -->
  <div id="notesModal">
    <div class="modal-content notes-modal">
      <h3>📝 My Notes</h3>
      <button id="createNoteBtn" class="create-note-btn">+ New Note</button>
      <div id="notesGrid" class="notes-grid">
        <!-- Notes will be dynamically added here -->
      </div>
      <button id="closeNotesBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <!-- Note Edit Modal -->
  <div id="noteEditModal">
    <div class="modal-content note-edit-modal">
      <h3 id="noteEditTitle">New Note</h3>
      <input type="text" id="noteTitleInput" placeholder="Note title..." maxlength="50" />
      <textarea id="noteContentInput" placeholder="Write your note here..." rows="10"></textarea>
      
      <div class="note-colors">
        <label>Color:</label>
        <div class="color-options">
          <div class="color-option yellow active" data-color="yellow"></div>
          <div class="color-option pink" data-color="pink"></div>
          <div class="color-option blue" data-color="blue"></div>
          <div class="color-option green" data-color="green"></div>
          <div class="color-option purple" data-color="purple"></div>
          <div class="color-option orange" data-color="orange"></div>
        </div>
      </div>
      
      <div class="note-actions">
        <button id="saveNoteBtn" class="save-note-btn">Save Note</button>
        <button id="deleteNoteBtn" class="delete-note-btn" style="display: none;">Delete Note</button>
        <button id="cancelNoteBtn" class="cancel-note-btn">Cancel</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/gh/BlizzardWolf7/Toast-Notification-Library@main/toast.js"></script>
  <script>
    /* CLOCK */
    function updateClock() {
      const now = new Date();
      document.getElementById("clock").textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    /* WEATHER (Open-Meteo, no API key) */
    let locationData = { city: "", country: "" };
    
    function getLocation(lat, lon) {
      // Reverse geocoding to get city and country
      fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
        .then(res => res.json())
        .then(data => {
          const city = data.city || data.locality || data.principalSubdivision || "Unknown";
          const country = data.countryName || "Unknown";
          locationData = { city, country };
          document.getElementById("location").textContent = `📍 ${city}, ${country}`;
        })
        .catch(() => {
          document.getElementById("location").textContent = `📍 Location unavailable`;
        });
    }

    function getWeather(lat, lon) {
      // Get location name
      getLocation(lat, lon);
      
      // Get weather data
      fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
        .then(res => res.json())
        .then(data => {
          const w = data.current_weather;
          document.getElementById("weather").textContent = `${w.temperature}°C, ${w.windspeed} km/h wind`;
          
          // Show combined weather and location toast only on error
        })
        .catch(() => {
          document.getElementById("weather").textContent = "Weather unavailable.";
          showToast({
            text: "Unable to fetch weather data",
            type: "error",
            duration: 4000,
            position: "bottom-right"
          });
        });
    }

    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(
        pos => getWeather(pos.coords.latitude, pos.coords.longitude),
        () => {
          document.getElementById("weather").textContent = "Location denied.";
          document.getElementById("location").textContent = "📍 Location access required";
          
          showToast({
            text: "Location access denied. Please enable location permissions.",
            type: "warning",
            duration: 5000,
            close: true,
            position: "bottom-right"
          });
        }
      );
    }

    /* TO-DO LISTS SYSTEM */
    const openTodoBtn = document.getElementById("openTodoBtn");
    const todoModal = document.getElementById("todoModal");
    const closeTodoBtn = document.getElementById("closeTodoBtn");
    const createListBtn = document.getElementById("createListBtn");
    const todoListsContainer = document.getElementById("todoListsContainer");
    const todoCount = document.getElementById("todoCount");
    
    // Create List Modal
    const createListModal = document.getElementById("createListModal");
    const newListNameInput = document.getElementById("newListNameInput");
    const createListSaveBtn = document.getElementById("createListSaveBtn");
    const createListCancelBtn = document.getElementById("createListCancelBtn");
    
    // View List Modal
    const viewListModal = document.getElementById("viewListModal");
    const viewListName = document.getElementById("viewListName");
    const viewListTaskInput = document.getElementById("viewListTaskInput");
    const viewListTaskNote = document.getElementById("viewListTaskNote");
    const taskPriority = document.getElementById("taskPriority");
    const taskDueDate = document.getElementById("taskDueDate");
    const viewListAddTaskBtn = document.getElementById("viewListAddTaskBtn");
    const viewListTasks = document.getElementById("viewListTasks");
    const taskProgress = document.getElementById("taskProgress");
    const closeViewListBtn = document.getElementById("closeViewListBtn");
    const listSettingsBtn = document.getElementById("listSettingsBtn");
    
    // List Settings Modal
    const listSettingsModal = document.getElementById("listSettingsModal");
    const settingsListNameInput = document.getElementById("settingsListNameInput");
    const saveListSettingsBtn = document.getElementById("saveListSettingsBtn");
    const deleteListFromSettingsBtn = document.getElementById("deleteListFromSettingsBtn");
    const cancelListSettingsBtn = document.getElementById("cancelListSettingsBtn");
    
    let todoLists = [];
    let currentListId = null;
    let createListColor = 'blue';
    let settingsListColor = 'blue';

    // Load to-do lists from localStorage
    function loadTodoLists() {
      todoLists = JSON.parse(localStorage.getItem("todoLists")) || [];
      renderTodoLists();
      updateTodoCount();
    }

    // Save to-do lists to localStorage
    function saveTodoLists() {
      localStorage.setItem("todoLists", JSON.stringify(todoLists));
      updateTodoCount();
    }

    // Update total tasks count
    function updateTodoCount() {
      const totalTasks = todoLists.reduce((sum, list) => sum + list.tasks.length, 0);
      const completedTasks = todoLists.reduce((sum, list) => 
        sum + list.tasks.filter(t => t.done).length, 0);
      todoCount.textContent = `${totalTasks} task${totalTasks !== 1 ? 's' : ''} (${completedTasks} done)`;
      
      // Count tasks overdue
      const tasksOverdue = todoLists.reduce((sum, list) => 
        sum + list.tasks.filter(t => !t.done && t.dueDate && isOverdue(t.dueDate)).length, 0);
      
      const tasksOverdueEl = document.getElementById("tasksOverdue");
      tasksOverdueEl.textContent = `${tasksOverdue} task${tasksOverdue !== 1 ? 's' : ''} overdue`;
      
      if (tasksOverdue > 0) {
        tasksOverdueEl.classList.add('has-tasks');
      } else {
        tasksOverdueEl.classList.remove('has-tasks');
      }
      
      // Count tasks due today
      const tasksDueToday = todoLists.reduce((sum, list) => 
        sum + list.tasks.filter(t => !t.done && t.dueDate && isToday(t.dueDate)).length, 0);
      
      const tasksDueTodayEl = document.getElementById("tasksDueToday");
      tasksDueTodayEl.textContent = `${tasksDueToday} task${tasksDueToday !== 1 ? 's' : ''} due today`;
      
      if (tasksDueToday > 0) {
        tasksDueTodayEl.classList.add('has-tasks');
      } else {
        tasksDueTodayEl.classList.remove('has-tasks');
      }
    }

    // Render to-do lists overview
    function renderTodoLists() {
      if (todoLists.length === 0) {
        todoListsContainer.innerHTML = `
          <div class="empty-todo">
            <div style="font-size: 3rem; margin-bottom: 1rem;">✓</div>
            <p>No lists yet. Create your first to-do list!</p>
          </div>
        `;
        return;
      }

      todoListsContainer.innerHTML = todoLists.map(list => {
        const completedCount = list.tasks.filter(t => t.done).length;
        
        // Count tasks overdue in this list
        const tasksOverdueInList = list.tasks.filter(t => 
          !t.done && t.dueDate && isOverdue(t.dueDate)
        ).length;
        
        // Count tasks due today in this list
        const tasksDueTodayInList = list.tasks.filter(t => 
          !t.done && t.dueDate && isToday(t.dueDate)
        ).length;
        
        const hasOverdue = tasksOverdueInList > 0;
        const hasDueToday = tasksDueTodayInList > 0;
        
        // Overdue takes priority over due today
        const highlightClass = hasOverdue ? 'has-overdue' : (hasDueToday ? 'has-due-today' : '');
        
        const overdueBadge = hasOverdue 
          ? `<div class="overdue-badge">⚠️ ${tasksOverdueInList} overdue</div>` 
          : '';
        
        const dueTodayBadge = hasDueToday && !hasOverdue
          ? `<div class="due-today-badge">📅 ${tasksDueTodayInList} due today</div>` 
          : '';
        
        const tasksPreview = list.tasks.slice(0, 5).map(task => `
          <div class="todo-list-task ${task.done ? 'done' : ''}">${task.text}</div>
        `).join('');
        
        return `
          <div class="todo-list-card ${list.color} ${highlightClass}" data-id="${list.id}">
            <div class="todo-list-header">
              <div class="todo-list-name">${list.name || 'Untitled List'}</div>
              <div class="todo-list-count">${completedCount}/${list.tasks.length}</div>
            </div>
            <div class="todo-list-tasks">
              ${tasksPreview || '<div class="todo-list-task" style="opacity: 0.5;">No tasks yet</div>'}
              ${list.tasks.length > 5 ? `<div class="todo-list-task" style="opacity: 0.5;">+ ${list.tasks.length - 5} more...</div>` : ''}
            </div>
            ${overdueBadge}
            ${dueTodayBadge}
          </div>
        `;
      }).join('');

      // Add click listeners to lists
      document.querySelectorAll('.todo-list-card').forEach(listEl => {
        listEl.addEventListener('click', () => {
          const id = listEl.dataset.id;
          openListView(id);
        });
      });
    }

    // Open to-do lists overview modal
    openTodoBtn.onclick = () => {
      todoModal.classList.add("active");
    };

    closeTodoBtn.onclick = () => {
      todoModal.classList.remove("active");
    };

    todoModal.onclick = (e) => {
      if (e.target === todoModal) {
        todoModal.classList.remove("active");
      }
    };

    // CREATE LIST MODAL
    createListBtn.onclick = () => {
      newListNameInput.value = "";
      createListColor = 'blue';
      updateCreateListColorSelection();
      createListModal.classList.add("active");
    };

    // Color selection for create modal
    document.querySelectorAll('#createListColors .list-color-option').forEach(option => {
      option.addEventListener('click', () => {
        createListColor = option.dataset.color;
        updateCreateListColorSelection();
      });
    });

    function updateCreateListColorSelection() {
      document.querySelectorAll('#createListColors .list-color-option').forEach(option => {
        if (option.dataset.color === createListColor) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    createListSaveBtn.onclick = () => {
      const name = newListNameInput.value.trim();

      if (!name) {
        showToast({
          text: "Please enter a list name",
          type: "warning",
          duration: 2500,
          position: "bottom-right"
        });
        return;
      }

      const newList = {
        id: Date.now().toString(),
        name,
        color: createListColor,
        tasks: []
      };
      todoLists.unshift(newList);
      saveTodoLists();
      renderTodoLists();
      createListModal.classList.remove("active");
      
      showToast({
        text: `List "${name}" created!`,
        type: "success",
        duration: 2500,
        position: "bottom-right"
      });
    };

    createListCancelBtn.onclick = () => {
      createListModal.classList.remove("active");
    };

    createListModal.onclick = (e) => {
      if (e.target === createListModal) {
        createListModal.classList.remove("active");
      }
    };

    // VIEW LIST MODAL
    function openListView(id) {
      const list = todoLists.find(l => l.id === id);
      if (!list) return;

      currentListId = id;
      viewListName.textContent = list.name;
      viewListTaskInput.value = "";
      viewListTaskNote.value = "";
      taskPriority.value = "none";
      taskDueDate.value = "";
      renderViewListTasks();
      viewListModal.classList.add("active");
    }

    // Helper function to check if date is today
    function isToday(dateString) {
      if (!dateString) return false;
      const today = new Date();
      const date = new Date(dateString);
      return date.toDateString() === today.toDateString();
    }

    // Helper function to check if date is overdue
    function isOverdue(dateString) {
      if (!dateString) return false;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const date = new Date(dateString);
      return date < today;
    }

    // Format due date for display
    function formatDueDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      const options = { month: 'short', day: 'numeric' };
      return date.toLocaleDateString(undefined, options);
    }

    function renderViewListTasks() {
      const list = todoLists.find(l => l.id === currentListId);
      if (!list) return;

      const completedCount = list.tasks.filter(t => t.done).length;
      taskProgress.textContent = `${completedCount}/${list.tasks.length} completed`;

      if (list.tasks.length === 0) {
        viewListTasks.innerHTML = '<div class="empty-tasks">No tasks yet. Add your first task above!</div>';
        return;
      }

      viewListTasks.innerHTML = list.tasks.map((task, index) => {
        const noteHtml = task.note ? `<div class="task-note">${task.note}</div>` : '';
        
        // Build metadata badges
        let metadataHtml = '';
        if (task.priority && task.priority !== 'none') {
          metadataHtml += `<span class="priority-badge ${task.priority}">${task.priority}</span>`;
        }
        if (task.dueDate) {
          const dueClass = isOverdue(task.dueDate) ? 'overdue' : (isToday(task.dueDate) ? 'today' : '');
          const dueIcon = isOverdue(task.dueDate) ? '⚠️' : (isToday(task.dueDate) ? '📅' : '📆');
          metadataHtml += `<span class="due-date-badge ${dueClass}">${dueIcon} ${formatDueDate(task.dueDate)}</span>`;
        }
        
        const metadataSection = metadataHtml ? `<div class="task-metadata">${metadataHtml}</div>` : '';
        
        return `
          <li>
            <span class="${task.done ? 'done' : ''}" data-index="${index}">
              <div class="task-text">${task.text}</div>
              ${noteHtml}
              ${metadataSection}
            </span>
            <button data-index="${index}">✕</button>
          </li>
        `;
      }).join('');

      // Add click listeners
      viewListTasks.querySelectorAll('span').forEach(span => {
        span.addEventListener('click', () => {
          const index = parseInt(span.dataset.index);
          toggleTaskCompletion(index);
        });
      });

      viewListTasks.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(btn.dataset.index);
          deleteTask(index);
        });
      });
    }

    function addTaskToCurrentList() {
      const text = viewListTaskInput.value.trim();
      const note = viewListTaskNote.value.trim();
      const priority = taskPriority.value;
      const dueDate = taskDueDate.value;
      
      if (!text) {
        showToast({
          text: "Please enter a task title",
          type: "warning",
          duration: 2000,
          position: "bottom-right"
        });
        return;
      }

      const list = todoLists.find(l => l.id === currentListId);
      if (!list) return;

      list.tasks.push({ 
        text, 
        note, 
        priority, 
        dueDate, 
        done: false 
      });
      saveTodoLists();
      renderViewListTasks();
      renderTodoLists();
      viewListTaskInput.value = "";
      viewListTaskNote.value = "";
      taskPriority.value = "none";
      taskDueDate.value = "";

      showToast({
        text: "Task added!",
        type: "success",
        duration: 2000,
        position: "bottom-right"
      });
    }

    function toggleTaskCompletion(index) {
      const list = todoLists.find(l => l.id === currentListId);
      if (!list) return;

      list.tasks[index].done = !list.tasks[index].done;
      saveTodoLists();
      renderViewListTasks();
      renderTodoLists();

      showToast({
        text: list.tasks[index].done ? "Task completed! 🎉" : "Task marked incomplete",
        type: list.tasks[index].done ? "success" : "info",
        duration: 2000,
        position: "bottom-right"
      });
    }

    function deleteTask(index) {
      const list = todoLists.find(l => l.id === currentListId);
      if (!list) return;

      const taskText = list.tasks[index].text;
      list.tasks.splice(index, 1);
      saveTodoLists();
      renderViewListTasks();
      renderTodoLists();

      showToast({
        text: `Task deleted: "${taskText}"`,
        type: "info",
        duration: 2500,
        position: "bottom-right"
      });
    }

    viewListAddTaskBtn.onclick = addTaskToCurrentList;

    // Enter key support for both inputs
    viewListTaskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addTaskToCurrentList();
      }
    });

    viewListTaskNote.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addTaskToCurrentList();
      }
    });

    closeViewListBtn.onclick = () => {
      viewListModal.classList.remove("active");
    };

    viewListModal.onclick = (e) => {
      if (e.target === viewListModal) {
        viewListModal.classList.remove("active");
      }
    };

    // LIST SETTINGS MODAL
    listSettingsBtn.onclick = () => {
      const list = todoLists.find(l => l.id === currentListId);
      if (!list) return;

      settingsListNameInput.value = list.name;
      settingsListColor = list.color;
      updateSettingsListColorSelection();
      listSettingsModal.classList.add("active");
    };

    // Color selection for settings modal
    document.querySelectorAll('#settingsListColors .list-color-option').forEach(option => {
      option.addEventListener('click', () => {
        settingsListColor = option.dataset.color;
        updateSettingsListColorSelection();
      });
    });

    function updateSettingsListColorSelection() {
      document.querySelectorAll('#settingsListColors .list-color-option').forEach(option => {
        if (option.dataset.color === settingsListColor) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    saveListSettingsBtn.onclick = () => {
      const name = settingsListNameInput.value.trim();

      if (!name) {
        showToast({
          text: "Please enter a list name",
          type: "warning",
          duration: 2500,
          position: "bottom-right"
        });
        return;
      }

      const listIndex = todoLists.findIndex(l => l.id === currentListId);
      if (listIndex !== -1) {
        todoLists[listIndex].name = name;
        todoLists[listIndex].color = settingsListColor;
        saveTodoLists();
        renderTodoLists();
        viewListName.textContent = name;
        listSettingsModal.classList.remove("active");

        showToast({
          text: "List settings updated!",
          type: "success",
          duration: 2000,
          position: "bottom-right"
        });
      }
    };

    deleteListFromSettingsBtn.onclick = () => {
      if (!currentListId) return;

      if (confirm("Are you sure you want to delete this list and all its tasks?")) {
        todoLists = todoLists.filter(l => l.id !== currentListId);
        saveTodoLists();
        renderTodoLists();
        listSettingsModal.classList.remove("active");
        viewListModal.classList.remove("active");
        
        showToast({
          text: "List deleted",
          type: "info",
          duration: 2500,
          position: "bottom-right"
        });
      }
    };

    cancelListSettingsBtn.onclick = () => {
      listSettingsModal.classList.remove("active");
    };

    listSettingsModal.onclick = (e) => {
      if (e.target === listSettingsModal) {
        listSettingsModal.classList.remove("active");
      }
    };

    // Keyboard shortcuts for modals
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (listSettingsModal.classList.contains("active")) {
          listSettingsModal.classList.remove("active");
        } else if (viewListModal.classList.contains("active")) {
          viewListModal.classList.remove("active");
        } else if (createListModal.classList.contains("active")) {
          createListModal.classList.remove("active");
        } else if (todoModal.classList.contains("active")) {
          todoModal.classList.remove("active");
        }
      }
    });

    // Initialize to-do lists
    loadTodoLists();

    /* GLOBAL SEARCH */
    const searchBtn = document.getElementById("searchBtn");
    const searchModal = document.getElementById("searchModal");
    const searchInput = document.getElementById("searchInput");
    const searchResults = document.getElementById("searchResults");
    const closeSearchBtn = document.getElementById("closeSearchBtn");

    // Open search modal
    searchBtn.onclick = () => {
      searchModal.classList.add("active");
      setTimeout(() => searchInput.focus(), 100);
    };

    closeSearchBtn.onclick = () => {
      searchModal.classList.remove("active");
      searchInput.value = "";
      searchResults.innerHTML = `
        <div class="search-empty">
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">🔍</div>
          <p>Type to search across all tasks and notes</p>
        </div>
      `;
    };

    searchModal.onclick = (e) => {
      if (e.target === searchModal) {
        searchModal.classList.remove("active");
      }
    };

    // Search functionality
    function performSearch(query) {
      if (!query || query.trim().length === 0) {
        searchResults.innerHTML = `
          <div class="search-empty">
            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">🔍</div>
            <p>Type to search across all tasks and notes</p>
          </div>
        `;
        return;
      }

      const searchTerm = query.toLowerCase();
      let taskResults = [];
      let noteResults = [];

      // Search through tasks
      todoLists.forEach(list => {
        list.tasks.forEach((task, index) => {
          const taskText = task.text.toLowerCase();
          const taskNote = task.note ? task.note.toLowerCase() : "";
          
          if (taskText.includes(searchTerm) || taskNote.includes(searchTerm)) {
            taskResults.push({
              type: 'task',
              listName: list.name,
              listId: list.id,
              listColor: list.color,
              taskIndex: index,
              title: task.text,
              note: task.note,
              priority: task.priority,
              dueDate: task.dueDate,
              done: task.done
            });
          }
        });
      });

      // Search through notes
      notes.forEach(note => {
        const noteTitle = note.title.toLowerCase();
        const noteContent = note.content.toLowerCase();
        
        if (noteTitle.includes(searchTerm) || noteContent.includes(searchTerm)) {
          noteResults.push({
            type: 'note',
            id: note.id,
            title: note.title,
            content: note.content,
            color: note.color
          });
        }
      });

      // Display results
      if (taskResults.length === 0 && noteResults.length === 0) {
        searchResults.innerHTML = `
          <div class="search-no-results">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">😔</div>
            <p>No results found for "${query}"</p>
          </div>
        `;
        return;
      }

      let resultsHtml = '';

      // Display task results
      if (taskResults.length > 0) {
        resultsHtml += `
          <div class="search-section">
            <div class="search-section-title">Tasks (${taskResults.length})</div>
            ${taskResults.map(result => {
              const highlightedTitle = highlightText(result.title, searchTerm);
              const highlightedNote = result.note ? highlightText(result.note, searchTerm) : '';
              const doneClass = result.done ? 'style="opacity: 0.6; text-decoration: line-through;"' : '';
              
              // Build metadata badges for search results
              let metadataHtml = '';
              if (result.priority && result.priority !== 'none') {
                metadataHtml += `<span class="priority-badge ${result.priority}">${result.priority}</span> `;
              }
              if (result.dueDate) {
                const dueClass = isOverdue(result.dueDate) ? 'overdue' : (isToday(result.dueDate) ? 'today' : '');
                const dueIcon = isOverdue(result.dueDate) ? '⚠️' : (isToday(result.dueDate) ? '📅' : '📆');
                metadataHtml += `<span class="due-date-badge ${dueClass}">${dueIcon} ${formatDueDate(result.dueDate)}</span>`;
              }
              
              return `
                <div class="search-result-item task" data-type="task" data-list-id="${result.listId}">
                  <div class="search-result-type">Task ${result.done ? '• Completed' : ''}</div>
                  <div class="search-result-title" ${doneClass}>${highlightedTitle}</div>
                  ${highlightedNote ? `<div class="search-result-content" ${doneClass}>${highlightedNote}</div>` : ''}
                  ${metadataHtml ? `<div class="task-metadata" style="margin-top: 0.5rem;">${metadataHtml}</div>` : ''}
                  <div class="search-result-meta">From list: ${result.listName}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      // Display note results
      if (noteResults.length > 0) {
        resultsHtml += `
          <div class="search-section">
            <div class="search-section-title">Notes (${noteResults.length})</div>
            ${noteResults.map(result => {
              const highlightedTitle = highlightText(result.title || 'Untitled', searchTerm);
              const highlightedContent = highlightText(result.content, searchTerm);
              
              return `
                <div class="search-result-item note" data-type="note" data-note-id="${result.id}">
                  <div class="search-result-type">Note • ${result.color}</div>
                  <div class="search-result-title">${highlightedTitle}</div>
                  <div class="search-result-content">${highlightedContent}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      }

      searchResults.innerHTML = resultsHtml;

      // Add click listeners to results
      document.querySelectorAll('.search-result-item').forEach(item => {
        item.addEventListener('click', () => {
          handleSearchResultClick(item);
        });
      });
    }

    // Highlight search terms
    function highlightText(text, search) {
      if (!text) return '';
      const regex = new RegExp(`(${search})`, 'gi');
      return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    // Handle search result clicks
    function handleSearchResultClick(item) {
      const type = item.dataset.type;
      
      if (type === 'task') {
        const listId = item.dataset.listId;
        searchModal.classList.remove("active");
        openListView(listId);
      } else if (type === 'note') {
        const noteId = item.dataset.noteId;
        searchModal.classList.remove("active");
        
        // Find and open the note
        const note = notes.find(n => n.id === noteId);
        if (note) {
          currentNoteId = noteId;
          noteEditTitle.textContent = "Edit Note";
          noteTitleInput.value = note.title;
          noteContentInput.value = note.content;
          selectedColor = note.color;
          updateColorSelection();
          deleteNoteBtn.style.display = "block";
          noteEditModal.classList.add("active");
        }
      }
    }

    // Real-time search
    searchInput.addEventListener("input", (e) => {
      performSearch(e.target.value);
    });

    /* SETTINGS */
    const settingsBtn = document.getElementById("settingsBtn");
    const modal = document.getElementById("settingsModal");
    const saveBtn = document.getElementById("saveSettings");
    const titleInput = document.getElementById("dashboardTitle");
    const nameInput = document.getElementById("userName");
    const accentInput = document.getElementById("accentColor");
    const darkToggle = document.getElementById("darkModeToggle");
    const showGreetingToggle = document.getElementById("showGreetingToggle");
    const titleElement = document.querySelector("h1");
    const greetingElement = document.getElementById("greeting");

    settingsBtn.onclick = () => modal.classList.add("active");
    modal.onclick = e => { if (e.target === modal) modal.classList.remove("active"); };

    function applySettings() {
      const user = JSON.parse(localStorage.getItem("settings")) || {};
      
      // Apply title
      if (user.title) {
        titleElement.textContent = user.title;
      }
      
      // Apply greeting visibility and content
      const showGreeting = user.showGreeting !== false; // Default to true
      if (showGreeting && user.name) {
        greetingElement.textContent = `Hello, ${user.name}!`;
        greetingElement.style.display = "block";
      } else if (showGreeting) {
        greetingElement.textContent = "";
        greetingElement.style.display = "block";
      } else {
        greetingElement.style.display = "none";
      }
      
      // Apply accent color
      if (user.accent) document.documentElement.style.setProperty("--accent", user.accent);
      
      // Apply dark mode
      if (user.darkMode) document.body.classList.add("dark");
      else document.body.classList.remove("dark");
      
      // Set input values
      titleInput.value = user.title || "My Productivity Dashboard";
      nameInput.value = user.name || "";
      accentInput.value = user.accent || "#667eea";
      darkToggle.checked = !!user.darkMode;
      showGreetingToggle.checked = showGreeting;
    }

    saveBtn.onclick = () => {
      const settings = {
        title: titleInput.value.trim() || "My Productivity Dashboard",
        name: nameInput.value.trim(),
        accent: accentInput.value,
        darkMode: darkToggle.checked,
        showGreeting: showGreetingToggle.checked
      };
      localStorage.setItem("settings", JSON.stringify(settings));
      modal.classList.remove("active");
      applySettings();
      
      // Show success toast for settings saved
      showToast({
        text: "Settings saved successfully!",
        type: "success",
        duration: 3000,
        position: "top-right"
      });
    };

    applySettings();

    /* SETTINGS SECTIONS TOGGLE */
    document.querySelectorAll('.section-header').forEach(header => {
      header.addEventListener('click', () => {
        const section = header.parentElement;
        section.classList.toggle('open');
      });
    });

    /* CLEAR CACHE BUTTON */
    const clearCacheBtn = document.getElementById('clearCacheBtn');
    
    clearCacheBtn.addEventListener('click', async () => {
      if (!confirm('Clear app cache? This will remove cached files but keep your tasks and notes safe.')) {
        return;
      }

      try {
        // Clear all caches
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          await Promise.all(
            cacheNames.map(cacheName => caches.delete(cacheName))
          );
          
          console.log('[Cache] All caches cleared successfully');
          
          showToast({
            text: "Cache cleared! The app will reload to fetch fresh content.",
            type: "success",
            duration: 3000,
            position: "top-right"
          });
          
          // Reload after a short delay to show the toast
          setTimeout(() => {
            window.location.reload(true);
          }, 1500);
        } else {
          showToast({
            text: "Cache API not supported in this browser",
            type: "warning",
            duration: 3000,
            position: "top-right"
          });
        }
      } catch (error) {
        console.error('[Cache] Error clearing cache:', error);
        showToast({
          text: "Failed to clear cache. Check console for details.",
          type: "error",
          duration: 4000,
          position: "top-right"
        });
      }
    });
    
    // Welcome toast on page load
    setTimeout(() => {
      const user = JSON.parse(localStorage.getItem("settings")) || {};
      const userName = user.name ? user.name : "there";
      
      showToast({
        text: `Welcome back, ${userName}! 👋`,
        type: "info",
        duration: 3500,
        position: "top-right"
      });
    }, 500);

    /* SHORTCUTS MODAL */
    const shortcutsBtn = document.getElementById("shortcutsBtn");
    const shortcutsModal = document.getElementById("shortcutsModal");
    const closeShortcutsBtn = document.getElementById("closeShortcutsBtn");

    shortcutsBtn.onclick = () => {
      shortcutsModal.classList.add("active");
    };

    closeShortcutsBtn.onclick = () => {
      shortcutsModal.classList.remove("active");
    };

    shortcutsModal.onclick = (e) => {
      if (e.target === shortcutsModal) {
        shortcutsModal.classList.remove("active");
      }
    };

    /* KEYBOARD SHORTCUTS */
    document.addEventListener("keydown", (e) => {
      // Escape - Close any open modal
      if (e.key === "Escape") {
        if (searchModal.classList.contains("active")) {
          searchModal.classList.remove("active");
        } else if (modal.classList.contains("active")) {
          modal.classList.remove("active");
        } else if (shortcutsModal.classList.contains("active")) {
          shortcutsModal.classList.remove("active");
        }
      }

      // Ctrl+F - Open search
      if ((e.ctrlKey || e.metaKey) && e.key === "f") {
        e.preventDefault();
        searchModal.classList.add("active");
        setTimeout(() => searchInput.focus(), 100);
      }

      // Ctrl+S - Open settings
      if ((e.ctrlKey || e.metaKey) && e.key === "s") {
        e.preventDefault();
        modal.classList.add("active");
      }

      // Ctrl+K - Open shortcuts guide
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        shortcutsModal.classList.add("active");
      }

      // Ctrl+D - Toggle dark mode
      if ((e.ctrlKey || e.metaKey) && e.key === "d") {
        e.preventDefault();
        darkToggle.checked = !darkToggle.checked;
        
        const settings = JSON.parse(localStorage.getItem("settings")) || {};
        settings.darkMode = darkToggle.checked;
        localStorage.setItem("settings", JSON.stringify(settings));
        applySettings();
        
        showToast({
          text: darkToggle.checked ? "Dark mode enabled" : "Light mode enabled",
          type: "success",
          duration: 2000,
          position: "top-right"
        });
      }
    });

    /* NOTES SYSTEM */
    const openNotesBtn = document.getElementById("openNotesBtn");
    const notesModal = document.getElementById("notesModal");
    const closeNotesBtn = document.getElementById("closeNotesBtn");
    const createNoteBtn = document.getElementById("createNoteBtn");
    const notesGrid = document.getElementById("notesGrid");
    const noteEditModal = document.getElementById("noteEditModal");
    const noteEditTitle = document.getElementById("noteEditTitle");
    const noteTitleInput = document.getElementById("noteTitleInput");
    const noteContentInput = document.getElementById("noteContentInput");
    const saveNoteBtn = document.getElementById("saveNoteBtn");
    const deleteNoteBtn = document.getElementById("deleteNoteBtn");
    const cancelNoteBtn = document.getElementById("cancelNoteBtn");
    const notesCount = document.getElementById("notesCount");
    
    let notes = [];
    let currentNoteId = null;
    let selectedColor = 'yellow';

    // Load notes from localStorage
    function loadNotes() {
      notes = JSON.parse(localStorage.getItem("notes")) || [];
      renderNotes();
      updateNotesCount();
    }

    // Save notes to localStorage
    function saveNotes() {
      localStorage.setItem("notes", JSON.stringify(notes));
      updateNotesCount();
    }

    // Update notes count
    function updateNotesCount() {
      const count = notes.length;
      notesCount.textContent = `${count} note${count !== 1 ? 's' : ''}`;
    }

    // Render notes grid
    function renderNotes() {
      if (notes.length === 0) {
        notesGrid.innerHTML = `
          <div class="empty-notes">
            <div style="font-size: 3rem; margin-bottom: 1rem;">📝</div>
            <p>No notes yet. Create your first note!</p>
          </div>
        `;
        return;
      }

      notesGrid.innerHTML = notes.map(note => {
        const preview = note.content.substring(0, 100);
        const date = new Date(note.date).toLocaleDateString();
        
        return `
          <div class="sticky-note ${note.color}" data-id="${note.id}">
            <div class="sticky-note-title">${note.title || 'Untitled'}</div>
            <div class="sticky-note-preview">${note.content || 'No content'}</div>
            <div class="sticky-note-date">${date}</div>
          </div>
        `;
      }).join('');

      // Add click listeners to notes
      document.querySelectorAll('.sticky-note').forEach(noteEl => {
        noteEl.addEventListener('click', () => {
          const id = noteEl.dataset.id;
          openNoteForEditing(id);
        });
      });
    }

    // Open notes modal
    openNotesBtn.onclick = () => {
      notesModal.classList.add("active");
    };

    // Close notes modal
    closeNotesBtn.onclick = () => {
      notesModal.classList.remove("active");
    };

    notesModal.onclick = (e) => {
      if (e.target === notesModal) {
        notesModal.classList.remove("active");
      }
    };

    // Create new note
    createNoteBtn.onclick = () => {
      currentNoteId = null;
      noteEditTitle.textContent = "New Note";
      noteTitleInput.value = "";
      noteContentInput.value = "";
      selectedColor = 'yellow';
      updateColorSelection();
      deleteNoteBtn.style.display = "none";
      noteEditModal.classList.add("active");
    };

    // Open note for editing
    function openNoteForEditing(id) {
      const note = notes.find(n => n.id === id);
      if (!note) return;

      currentNoteId = id;
      noteEditTitle.textContent = "Edit Note";
      noteTitleInput.value = note.title;
      noteContentInput.value = note.content;
      selectedColor = note.color;
      updateColorSelection();
      deleteNoteBtn.style.display = "block";
      noteEditModal.classList.add("active");
    }

    // Color selection
    document.querySelectorAll('.color-option').forEach(option => {
      option.addEventListener('click', () => {
        selectedColor = option.dataset.color;
        updateColorSelection();
      });
    });

    function updateColorSelection() {
      document.querySelectorAll('.color-option').forEach(option => {
        if (option.dataset.color === selectedColor) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    // Save note
    saveNoteBtn.onclick = () => {
      const title = noteTitleInput.value.trim();
      const content = noteContentInput.value.trim();

      if (!title && !content) {
        showToast({
          text: "Please add a title or content to your note",
          type: "warning",
          duration: 2500,
          position: "bottom-right"
        });
        return;
      }

      if (currentNoteId) {
        // Update existing note
        const noteIndex = notes.findIndex(n => n.id === currentNoteId);
        if (noteIndex !== -1) {
          notes[noteIndex] = {
            ...notes[noteIndex],
            title,
            content,
            color: selectedColor,
            date: Date.now()
          };
          
          showToast({
            text: "Note updated successfully!",
            type: "success",
            duration: 2000,
            position: "bottom-right"
          });
        }
      } else {
        // Create new note
        const newNote = {
          id: Date.now().toString(),
          title,
          content,
          color: selectedColor,
          date: Date.now()
        };
        notes.unshift(newNote);
        
        showToast({
          text: "Note created successfully!",
          type: "success",
          duration: 2000,
          position: "bottom-right"
        });
      }

      saveNotes();
      renderNotes();
      noteEditModal.classList.remove("active");
    };

    // Delete note
    deleteNoteBtn.onclick = () => {
      if (!currentNoteId) return;

      if (confirm("Are you sure you want to delete this note?")) {
        notes = notes.filter(n => n.id !== currentNoteId);
        saveNotes();
        renderNotes();
        noteEditModal.classList.remove("active");
        
        showToast({
          text: "Note deleted",
          type: "info",
          duration: 2000,
          position: "bottom-right"
        });
      }
    };

    // Cancel note editing
    cancelNoteBtn.onclick = () => {
      noteEditModal.classList.remove("active");
    };

    noteEditModal.onclick = (e) => {
      if (e.target === noteEditModal) {
        noteEditModal.classList.remove("active");
      }
    };

    // Update keyboard shortcuts to close note modals with Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (noteEditModal.classList.contains("active")) {
          noteEditModal.classList.remove("active");
        }
        if (notesModal.classList.contains("active")) {
          notesModal.classList.remove("active");
        }
      }
    });

    // Initialize notes
    loadNotes();

    /* PWA SUPPORT */
    const lastCheckedElement = document.getElementById('lastChecked');
    
    // Format time ago
    function formatTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (seconds < 10) return 'Just now';
      if (seconds < 60) return `${seconds} seconds ago`;
      if (minutes === 1) return '1 minute ago';
      if (minutes < 60) return `${minutes} minutes ago`;
      if (hours === 1) return '1 hour ago';
      if (hours < 24) return `${hours} hours ago`;
      if (days === 1) return '1 day ago';
      return `${days} days ago`;
    }
    
    // Update last checked time
    function updateLastChecked() {
      const timestamp = Date.now();
      localStorage.setItem('lastUpdateCheck', timestamp.toString());
      if (lastCheckedElement) {
        lastCheckedElement.textContent = formatTimeAgo(timestamp);
      }
    }
    
    // Update the display periodically
    setInterval(() => {
      const lastCheck = localStorage.getItem('lastUpdateCheck');
      if (lastCheck && lastCheckedElement) {
        lastCheckedElement.textContent = formatTimeAgo(parseInt(lastCheck));
      }
    }, 60000); // Update every 60 seconds
    
    // Initialize last checked display
    const lastCheck = localStorage.getItem('lastUpdateCheck');
    if (lastCheck && lastCheckedElement) {
      lastCheckedElement.textContent = formatTimeAgo(parseInt(lastCheck));
    }
    
    // Register service worker
    if ('serviceWorker' in navigator) {
      let refreshing = false;
      
      // Reload page when new service worker takes control
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        console.log('[PWA] New service worker activated, reloading...');
        window.location.reload();
      });
      
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('[PWA] Service Worker registered successfully:', registration.scope);
            
            // Update last checked on initial load
            updateLastChecked();
            
            // Check for updates periodically (every 5 minutes)
            setInterval(() => {
              registration.update();
              updateLastChecked();
            }, 300000); // 5 minutes = 300,000ms
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('[PWA] New service worker detected');
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker available - auto-update
                  console.log('[PWA] New version available, auto-updating...');
                  
                  showToast({
                    text: "Update found! Installing new version... 🔄",
                    type: "info",
                    duration: 3000,
                    position: "top-right"
                  });
                  
                  // Tell the new service worker to skip waiting and activate immediately
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch((error) => {
            console.error('[PWA] Service Worker registration failed:', error);
          });
      });
    }

    /* CONNECTION STATUS */
    const statusIndicator = document.getElementById("statusIndicator");
    const statusText = statusIndicator.querySelector(".status-text");

    function updateConnectionStatus() {
      const isOnline = navigator.onLine;
      
      if (isOnline) {
        statusIndicator.classList.remove("offline");
        statusIndicator.classList.add("online");
        statusText.textContent = "Online";
      } else {
        statusIndicator.classList.remove("online");
        statusIndicator.classList.add("offline");
        statusText.textContent = "Offline";
      }
    }

    // Set initial status
    updateConnectionStatus();

    // Online/Offline detection
    window.addEventListener('online', () => {
      updateConnectionStatus();
      showToast({
        text: "Back online! 🌐",
        type: "success",
        duration: 3000,
        position: "bottom-right"
      });
    });

    window.addEventListener('offline', () => {
      updateConnectionStatus();
      showToast({
        text: "You're offline. Don't worry, the app still works! 📱",
        type: "warning",
        duration: 5000,
        close: true,
        position: "bottom-right"
      });
    });
  </script>
</body>
</html>


